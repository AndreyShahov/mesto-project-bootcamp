(()=>{"use strict";var e=document.querySelector(".profile__edit-button"),t=document.querySelector(".profile__add-button"),n=document.querySelector(".profile__overlay"),o=document.querySelector(".popup_type_edit"),r=document.querySelector(".popup_type_image"),c=document.querySelector(".popup_type_add-card"),a=document.querySelector(".popup_type_change-avatar"),i=document.querySelector(".elements"),u=document.querySelector(".popup__bigImage"),s=document.querySelector(".popup__caption"),l=document.forms.edit,d=document.forms.add,f=document.forms.avatar,p=l.elements.userName,m=l.elements.about,h=d.elements.cardName,v=d.elements.link,_=f.elements.link,y=Array.from(document.querySelectorAll(".popup")),b=o.querySelector(".popup__save-btn"),S=c.querySelector(".popup__save-btn"),k=a.querySelector(".popup__save-btn"),q=document.querySelector(".profile__author"),E=document.querySelector(".profile__author-subline"),g=document.querySelector(".profile__avatar"),L={btnStateDisabled:"popup__save-btn_disabled",input:".popup__input",saveBtn:".popup__save-btn"};function C(e,t,n){t?(e.setAttribute("disabled",!0),e.classList.add(n.btnStateDisabled)):(e.removeAttribute("disabled"),e.classList.remove(n.btnStateDisabled))}function j(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?C(t,!1,L):C(t,!0,L)}function P(e){e.classList.add("popup_opened"),document.addEventListener("keydown",A)}function w(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",A)}function x(e){var t=document.querySelector("#element").content.querySelector(".element").cloneNode(!0),n=t.querySelector(".element__trash-btn"),o=t.querySelector(".element__like-btn"),c=t.querySelector(".element__image"),a=t.querySelector(".element__likes-counter");return c.src=e.link,c.alt=e.name,t.querySelector(".element__title").textContent=e.name,n.addEventListener("click",(function(){n.closest(".element").remove(),function(e){fetch("https://nomoreparties.co/v1/wbf-cohort-3/cards/".concat(e._id),{method:"DELETE",headers:{authorization:"760e0d80-494a-4d91-971a-4eb297900ae7"}}).then((function(e){if(!e.ok)return Promise.reject("Что-то не так: ".concat(e.status))})).catch((function(e){return console.log(e)}))}(e)})),e.likes.find((function(e){return"135e568bbf5b7f0594e3ab64"===e._id}))&&o.classList.add("element__like-btn_active"),o.addEventListener("click",(function(){o.classList.toggle("element__like-btn_active"),o.classList.contains("element__like-btn_active")?function(e){return fetch("https://nomoreparties.co/v1/wbf-cohort-3/cards/likes/".concat(e._id),{method:"PUT",headers:{authorization:"760e0d80-494a-4d91-971a-4eb297900ae7"}}).then((function(e){return e.ok?e.json():Promise.reject("Что-то не так: ".concat(e.status))}))}(e).then((function(e){a.textContent=e.likes.length})).catch((function(e){return console.log(e)})):function(e){return fetch("https://nomoreparties.co/v1/wbf-cohort-3/cards/likes/".concat(e._id),{method:"DELETE",headers:{authorization:"760e0d80-494a-4d91-971a-4eb297900ae7"}}).then((function(e){return e.ok?e.json():Promise.reject("Что-то не так: ".concat(e.status))}))}(e).then((function(e){a.textContent=e.likes.length})).catch((function(e){return console.log(e)}))})),a.textContent=e.likes.length,c.addEventListener("click",(function(){return function(e,t,n){e.src=n.link,e.alt=n.name,t.textContent=n.name,P(r)}(u,s,e)})),t}function A(e){"Escape"===e.key&&y.forEach((function(e){w(e)}))}function T(e,t){t.textContent=e?"Сохранение...":"Сохранение"}e.addEventListener("click",(function(){return P(o)})),t.addEventListener("click",(function(){return P(c)})),n.addEventListener("click",(function(){return P(a)})),l.addEventListener("submit",(function(e){e.preventDefault();var t=p.value,n=m.value;q.textContent=t,E.textContent=n,T(!0,b),function(e,t){return fetch("https://nomoreparties.co/v1/wbf-cohort-3/users/me",{method:"PATCH",headers:{authorization:"760e0d80-494a-4d91-971a-4eb297900ae7","Content-Type":"application/json"},body:JSON.stringify({name:e,about:t})}).then((function(e){if(!e.ok)return Promise.reject("Что-то не так: ".concat(e.status))}))}(t,n).catch((function(e){return console.log(e)})).finally((function(){return T(!1,b)})),w(o)})),d.addEventListener("submit",(function(e){e.preventDefault();var t=h.value,n=v.value;T(!0,S),function(e,t){return fetch("https://nomoreparties.co/v1/wbf-cohort-3/cards",{method:"POST",headers:{authorization:"760e0d80-494a-4d91-971a-4eb297900ae7","Content-Type":"application/json"},body:JSON.stringify({name:e,link:t})}).then((function(e){return e.ok?e.json():Promise.reject("Что-то не так: ".concat(e.status))}))}(t,n).then((function(e){!function(e,t){var n=x(e);t.prepend(n)}(e,i)})).catch((function(e){return console.log(e)})).finally((function(){return T(!1,S)})),w(c),d.reset(),C(S,!0,L)})),f.addEventListener("submit",(function(e){e.preventDefault();var t=_.value;g.src=t,T(!0,k),function(e){return fetch("https://nomoreparties.co/v1/wbf-cohort-3/users/me/avatar",{method:"PATCH",headers:{authorization:"760e0d80-494a-4d91-971a-4eb297900ae7","Content-Type":"application/json"},body:JSON.stringify({avatar:e})}).then((function(e){if(!e.ok)return Promise.reject("Что-то не так: ".concat(e.status))}))}(t).catch((function(e){return console.log(e)})).finally((function(){return T(!1,k)})),w(a),f.reset(),C(k,!0,L)})),y.forEach((function(e){e.querySelector(".popup__overlay").addEventListener("click",(function(){return w(e)}))})),y.forEach((function(e){e.querySelector(".popup__close-btn").addEventListener("click",(function(){return w(e)}))})),function(e){Array.from(document.forms).forEach((function(t){return function(e,t){var n=Array.from(e.querySelectorAll(t.input)),o=e.querySelector(t.saveBtn);j(n,o),n.forEach((function(e){e.addEventListener("input",(function(){var t,r;r=(t=e).parentNode.querySelector("#".concat(t.id,"-error")),function(e){return e.setCustomValidity(""),e.validity.valueMissing?(e.setCustomValidity("Вы пропустили это поле."),!1):e.validity.tooShort||e.validity.tooLong?(e.setCustomValidity("Должно быть от 2 до 30 символов."),!1):e.validity.typeMismatch&&"url"===e.type?(e.setCustomValidity("Введите адрес."),!1):void e.reportValidity()}(t)||(r.textContent=t.validationMessage),j(n,o)}))}))}(t,e)}))}(L),fetch("https://nomoreparties.co/v1/wbf-cohort-3/users/me",{headers:{authorization:"760e0d80-494a-4d91-971a-4eb297900ae7"}}).then((function(e){return e.ok?e.json():Promise.reject("Что-то не так: ".concat(e.status))})).then((function(e){q.textContent=e.name,p.value=e.name,E.textContent=e.about,m.value=e.about,g.src=e.avatar})).catch((function(e){return console.log(e)})),fetch("https://nomoreparties.co/v1/wbf-cohort-3/cards",{headers:{authorization:"760e0d80-494a-4d91-971a-4eb297900ae7"}}).then((function(e){return e.ok?e.json():Promise.reject("Что-то не так: ".concat(e.status))})).then((function(e){e.forEach((function(e){"135e568bbf5b7f0594e3ab64"===e.owner._id?function(e,t){var n=x(e);t.append(n)}(e,i):function(e,t){var n=x(e);t.append(n),n.querySelector(".element__trash-btn").remove()}(e,i)}))})).catch((function(e){return console.log(e)}))})();